import org.apache.tools.ant.filters.FixCrLfFilter
import org.apache.tools.ant.filters.ReplaceTokens

generatedDir = new File(buildDir, 'quickstart-generated')

task generateArchetype(type: Copy) {
    srcDir = file('prototypes')

    inputs.file srcDir
    outputs.dir generatedDir

    generatedDir.mkdirs()

    from srcDir
    into generatedDir

    // Use some of the filters provided by Ant
    filter(FixCrLfFilter)
    filter(ReplaceTokens, tokens: [
            quickstartVersion: version, tapestryReleaseVersion: version,
            servletApiReleaseVersion: servletAPIVersion,
            testngReleaseVersion: testngVersion, easymockReleaseVersion: easymockVersion
    ])

}

task build(type: Jar, dependsOn: 'generateArchetype') {

    description = "Creates a the JAR archive for the quickstart archetype"
    group = "Release artifact"

    destinationDir = buildDir
    baseName = "quickstart"
    version = project.version

    from generatedDir
}

artifacts {
    archives build
}
